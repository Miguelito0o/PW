<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Meu Jardim</title>
  <link rel="stylesheet" href="/stylesheets/style.css" />

</head>
<body>

  <!-- ðŸŒ¿ Header parcial -->
  <%- include('partials/header', { jardim: jardins[0], oxigenioTotal: oxigenioTotal }) %>

  <!-- DecoraÃ§Ãµes -->
  <div class="decoracoes-jardim">
    <img src="/images/icones/sol.png" class="icon-deco sol">
    <img src="/images/icones/borboletas.png" class="icon-flutuante borboletas">
    <img src="/images/icones/borboletas_2.png" class="icon-flutuante borboletas_2">
    <img src="/images/icones/grama.png" class="icon-deco grama">
    <img src="/images/icones/grama.png" class="icon-deco grama2">
    <img src="/images/icones/grama.png" class="icon-deco grama3">
  </div>


  <!-- ðŸª´ Vasos renderizados -->
  <main class="jardim-container">
    <% jardins[0].vasos.slice(0, 6).forEach((vaso, index) => { %>
      <div class="vaso">
      <% if (vaso.planta) { %>
        <div class="vaso-com-planta">
          <img src="/images/icones/vaso.png" class="vaso-base" alt="Vaso">
          <img src="/images/plantas/<%= vaso.planta.imagem %>" class="planta-imagem" alt="<%= vaso.planta.nome %>">
        </div>
        <h3><%= vaso.planta.nome %></h3>
        <p><%= new Date(vaso.dataPlantio).toLocaleDateString() %></p>
      <% } else { %>
        <form>
          <button type="button" class="pa-button" data-vaso-index="<%= index %>">
            <img src="/images/icones/pa.png" class="pa" alt="Plantar">
          </button>
        </form>
        <img src="/images/icones/vaso.png" alt="Vaso vazio">
      <% } %>
    </div>
  <% }) %>
  </main>

  <!-- ðŸŒ¿ Modal de inventÃ¡rio -->
  <div id="plantModal" class="modal" style="display: none;">
    <div class="modal-content">
      <h2>Escolha a planta ðŸŒ±</h2>
      <form id="plantForm" action="/api/plantar" method="POST">
        <input type="hidden" name="vasoIndex" id="vasoIndexInput">
        <ul style="text-align: left;">
          <% inventario.forEach(item => { %>
            <li>
              <label>
                <input type="radio" name="plantaNome" value="<%= item.planta.nome %>" required>
                <%= item.planta.nome %> (x<%= item.quantidade %>)
              </label>
            </li>
          <% }) %>
        </ul>
        <button type="submit">ðŸŒ¼ Plantar</button>
        <button type="button" onclick="fecharModal()">Cancelar</button>
      </form>
    </div>
  </div>

  <!-- ðŸ§  Script da pÃ¡ + modal -->
  <script>
    const modal = document.getElementById('plantModal');
    const vasoIndexInput = document.getElementById('vasoIndexInput');

    document.querySelectorAll('.pa-button').forEach(botao => {
      botao.addEventListener('click', e => {
        e.preventDefault();
        const imgPa = botao.querySelector('.pa');
        if (imgPa) {
          imgPa.classList.add('animar');
          setTimeout(() => imgPa.classList.remove('animar'), 600);
        }
        const index = botao.getAttribute('data-vaso-index');
        vasoIndexInput.value = index;
        modal.style.display = 'flex';
      });
    });

    function fecharModal() {
      modal.style.display = 'none';
    }
  </script>

  <!-- ðŸŒ¾ RodapÃ© -->
  <%- include('partials/footer'); %>
</body>
</html>
